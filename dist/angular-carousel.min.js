/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.2 - 2014-04-04
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]).config(["$provide",function(a){a.decorator("$rootScope",["$delegate",function(a){return a.safeApply=function(b){var c=a.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():a.$apply(b)},a}])}]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(a){a.prev=function(){a.index--},a.next=function(){a.index++}},template:'<div class="rn-carousel-controls"><span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span><span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span></div>'}}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}"></span></div>'}}]),function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$rootScope",function(a,b,c,d,e,f){var g=b.navigator.userAgent.toLowerCase(),h=!1,i=g.match(/android/i);if(i){var j=g.match(/android ([\d\.]+)/)[1].split(".");if(j){var k=Number(j[0]);h=4>k}}var l=0,m=75,n=.05,o=3,p=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame;return{restrict:"A",scope:!0,compile:function(g,i){var j,k,q=g.children()[0].attributes,r=!1,s=!1,t=!1;return g.addClass("rn-carousel-slides"),g.children().addClass("rn-carousel-slide"),["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(a){var b=q[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(j=c[1],k=c[2],j)return angular.isDefined(i.rnCarouselBuffered)&&(s=!0,b.value=j+" in "+k+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),r=!0,!1}return!0}),function(g,i,j){function q(){for(var a=[],b=0;R>b;b++)a[b]=b;g.carouselIndicatorArray=a}function u(){return J=0,h&&(J=document.width),(0==J||"undefined"==typeof J)&&(J=angular.element(b).outerWidth(!0)),J}function v(){U.css("width","100%");var a=u();a&&U.css("width",a+"px")}function w(a){isNaN(a)&&(a=g.carouselIndex*J),Q=a;var b=-Math.round(Q);b+=g.carouselBufferIndex*J,T[0].style[K]=Z?"translate3d("+b+"px, 0, 0)":"translate("+b+"px, 0)"}function x(){var a,b;N&&(a=Date.now()-P,b=N*Math.exp(-a/m),b>o||-o>b?(w(O-b),p(x)):A(O/J))}function y(a){return a>=R?R:0>=a?0:a}function z(){var a=0,b=(g.carouselBufferSize-1)/2;s&&(a=g.carouselIndex<=b?0:R<g.carouselBufferSize?0:g.carouselIndex>R-g.carouselBufferSize?R-g.carouselBufferSize:g.carouselIndex-b),g.carouselBufferIndex=a}function A(a,b){return isNaN(a)&&(a=g.carouselIndex),b?(Q=a*J,void G(null,null,!0)):(g.carouselIndex=y(a),z(),t?f.safeApply():g.$digest(),void w())}function B(){return n*J}function C(a){S=!0,G({x:a.clientX,y:a.clientY},a)}function D(a){var b=a;return 0===g.carouselIndex?b=Math.max(-B(),b):g.carouselIndex===R-1&&(b=Math.min((R-1)*J+B(),b)),b}function E(a){return c.bind("mouseup",C),L=!0,M=a.x,N=0,P=Date.now(),!1}function F(a){var b,c;return L&&(b=a.x,c=M-b,(c>2||-2>c)&&(S=!0,M=b,p(function(){w(D(Q+c))}))),!1}function G(a,b,d){if(!b||S){c.unbind("mouseup",C),L=!1,S=!1,O=Q,g.carouselIndex+1>=R&&f.$emit("carousel:loadMore");var e=B(),h=g.carouselIndex*J,i=h-O,j=-Math[i>=0?"ceil":"floor"](i/J),k=Math.abs(i)>e;j+g.carouselIndex>=R&&(j=R-1-g.carouselIndex),j+g.carouselIndex<0&&(j=-g.carouselIndex);var l=k?j:0;return O=(l+g.carouselIndex)*J,N=O-Q,P=Date.now(),d&&(N=Q-h),p(x),!1}}function H(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}function I(){v(),A()}l++;var J,K,L,M,N,O,P,Q=0,R=0,S=!1,T=i.wrap("<div id='carousel-"+l+"' class='rn-carousel-container'></div>"),U=T.parent();if((angular.isDefined(j.rnCarouselIndicator)||angular.isDefined(j.rnCarouselControl))&&(q(),g.$watch("carouselIndex",function(a){g.indicatorIndex=a}),g.$watch("indicatorIndex",function(a){A(a,!0)})),angular.isDefined(j.rnCarouselIndicator)){var V=e("<div id='carousel-"+l+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(g);U.append(V)}if(angular.isDefined(j.rnCarouselControl)){var W=e("<div id='carousel-"+l+"-controls' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-controls class='rn-carousel-controls'></div>")(g);U.append(W)}if(g.carouselBufferIndex=0,g.carouselBufferSize=5,g.carouselIndex=0,j.rnCarouselIndex){var X=function(a){Y.assign(g.$parent,a)},Y=d(j.rnCarouselIndex);angular.isFunction(Y.assign)?(g.$watch("carouselIndex",function(a){X(a)}),g.carouselIndex=Y(g),g.$parent.$watch(Y,function(a){void 0!==a&&(a>=R?(a=R-1,X(a)):0>a&&(a=0,X(a)),A(a,!0))}),t=!0):isNaN(j.rnCarouselIndex)||(g.carouselIndex=parseInt(j.rnCarouselIndex,10))}r?g.$watchCollection(k,function(a){R=0,angular.isArray(a)?R=a.length:angular.isObject(a)&&(R=Object.keys(a).length),q(),J||v(),A(g.carouselIndex)}):(R=i.children().length,q(),v()),j.$observe("rnCarouselSwipe",function(b){"false"!==b&&"off"!==b?a.bind(T,{start:E,move:F,end:G,cancel:function(a){G({},a)}}):T.unbind()}),t||A(g.carouselIndex),K="transform",["webkit","Moz","O","ms"].every(function(a){var b=a+"Transform";return"undefined"!=typeof document.body.style[b]?(K=b,!1):!0});var Z=H(),$=angular.element(b);$.bind("orientationchange",I),$.bind("resize",I),g.$on("$destroy",function(){c.unbind("mouseup",C),$.unbind("orientationchange",I),$.unbind("resize",I)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();